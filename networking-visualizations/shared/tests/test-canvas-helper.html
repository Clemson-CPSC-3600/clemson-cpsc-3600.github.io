<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CanvasHelper Test Suite</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    h1 {
      color: #2c3e50;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
    }
    
    h2 {
      color: #34495e;
      margin-top: 30px;
    }
    
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .test-case {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .test-case h3 {
      margin-top: 0;
      color: #2c3e50;
      font-size: 16px;
      border-bottom: 1px solid #ecf0f1;
      padding-bottom: 10px;
    }
    
    canvas {
      border: 1px solid #bdc3c7;
      border-radius: 4px;
      width: 100%;
      max-width: 100%;
      height: auto;
      background: white;
    }
    
    .controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    button:hover {
      background: #2980b9;
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    .status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    #main-demo {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>üé® CanvasHelper Test Suite</h1>
  
  <div id="main-demo">
    <h2>Interactive Network Visualization Demo</h2>
    <canvas id="main-canvas" width="800" height="400"></canvas>
    <div class="controls">
      <button onclick="animatePackets()">Animate Packets</button>
      <button onclick="toggleGrid()">Toggle Grid</button>
      <button onclick="changeTheme()">Change Theme</button>
      <button onclick="resetDemo()">Reset</button>
    </div>
    <div id="main-status" class="status success">Ready - Click canvas to see tooltips, buttons to interact</div>
  </div>
  
  <h2>Individual Feature Tests</h2>
  
  <div class="test-grid">
    <div class="test-case">
      <h3>Basic Shapes</h3>
      <canvas id="shapes-canvas" width="280" height="200"></canvas>
    </div>
    
    <div class="test-case">
      <h3>Network Nodes</h3>
      <canvas id="nodes-canvas" width="280" height="200"></canvas>
    </div>
    
    <div class="test-case">
      <h3>Network Links</h3>
      <canvas id="links-canvas" width="280" height="200"></canvas>
    </div>
    
    <div class="test-case">
      <h3>Packets & Animation</h3>
      <canvas id="packets-canvas" width="280" height="200"></canvas>
    </div>
    
    <div class="test-case">
      <h3>Text & Labels</h3>
      <canvas id="text-canvas" width="280" height="200"></canvas>
    </div>
    
    <div class="test-case">
      <h3>Progress Bars</h3>
      <canvas id="progress-canvas" width="280" height="200"></canvas>
    </div>
    
    <div class="test-case">
      <h3>Gradients</h3>
      <canvas id="gradients-canvas" width="280" height="200"></canvas>
    </div>
    
    <div class="test-case">
      <h3>Grid Background</h3>
      <canvas id="grid-canvas" width="280" height="200"></canvas>
    </div>
  </div>

  <script type="module">
    import { CanvasHelper } from '../utils/CanvasHelper.js';
    import { COLORS } from '../constants/colors.js';
    import { SIZES } from '../constants/sizes.js';
    import { NetworkFormatter } from '../utils/NetworkFormatter.js';
    
    // Test 1: Basic Shapes
    function testShapes() {
      const canvas = document.getElementById('shapes-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      helper.clear(COLORS.UI.BACKGROUND);
      
      // Circle
      helper.drawCircle(50, 50, 30, {
        fillColor: COLORS.PACKET.DEFAULT,
        strokeColor: COLORS.UI.BORDER,
        strokeWidth: 2
      });
      
      // Rectangle
      helper.drawRect(120, 30, 60, 40, {
        fillColor: COLORS.NODES.SERVER,
        strokeColor: COLORS.UI.BORDER,
        strokeWidth: 2
      });
      
      // Rounded Rectangle
      helper.drawRoundedRect(200, 25, 70, 50, 10, {
        fillColor: COLORS.NODES.ROUTER,
        strokeColor: COLORS.UI.BORDER,
        strokeWidth: 2
      });
      
      // Lines
      helper.drawLine(30, 120, 250, 120, {
        color: COLORS.LINKS.ETHERNET,
        width: 2
      });
      
      helper.drawLine(30, 140, 250, 140, {
        color: COLORS.LINKS.WIRELESS,
        width: 2,
        dashed: true,
        dashArray: [5, 5]
      });
      
      // Arrow
      helper.drawArrow(30, 160, 250, 160, {
        color: COLORS.UI.HIGHLIGHT,
        size: 10
      });
    }
    
    // Test 2: Network Nodes
    function testNodes() {
      const canvas = document.getElementById('nodes-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      helper.clear(COLORS.UI.BACKGROUND);
      
      // Different node types
      helper.drawNode(50, 50, 'host', { icon: 'üíª', label: 'Host' });
      helper.drawNode(140, 50, 'router', { icon: 'üîÑ', label: 'Router' });
      helper.drawNode(230, 50, 'server', { icon: 'üñ•Ô∏è', label: 'Server' });
      
      helper.drawNode(50, 130, 'switch', { label: 'Switch' });
      helper.drawNode(140, 130, 'firewall', { label: 'Firewall', selected: true });
      helper.drawNode(230, 130, 'client', { label: 'Client' });
    }
    
    // Test 3: Network Links
    function testLinks() {
      const canvas = document.getElementById('links-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      helper.clear(COLORS.UI.BACKGROUND);
      
      // Different link types
      helper.drawLink(30, 30, 250, 30, { type: 'ethernet', label: 'Ethernet' });
      helper.drawLink(30, 60, 250, 60, { type: 'fiber', arrow: true });
      helper.drawLink(30, 90, 250, 90, { type: 'wireless' });
      helper.drawLink(30, 120, 250, 120, { type: 'satellite', active: true });
      
      // Link with nodes
      helper.drawNode(50, 170, 'host', {});
      helper.drawNode(230, 170, 'server', {});
      helper.drawLink(80, 170, 200, 170, { type: 'ethernet', arrow: true });
    }
    
    // Test 4: Packets
    function testPackets() {
      const canvas = document.getElementById('packets-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      let pulse = 0;
      
      function animate() {
        helper.clear(COLORS.UI.BACKGROUND);
        
        // Static packets
        helper.drawPacket(50, 50, { type: 'TCP', label: '1' });
        helper.drawPacket(100, 50, { type: 'UDP', label: '2' });
        helper.drawPacket(150, 50, { type: 'ICMP', label: '3' });
        helper.drawPacket(200, 50, { type: 'ERROR', label: 'X' });
        
        // Animated packet with pulse
        pulse = (pulse + 0.02) % 1;
        helper.drawPacket(140, 120, { 
          type: 'DEFAULT', 
          pulse: pulse,
          label: 'P'
        });
        
        // Moving packet
        const x = 50 + (Date.now() / 10) % 180;
        helper.drawPacket(x, 170, { type: 'TCP' });
        
        requestAnimationFrame(animate);
      }
      animate();
    }
    
    // Test 5: Text and Labels
    function testText() {
      const canvas = document.getElementById('text-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      helper.clear(COLORS.UI.BACKGROUND);
      
      // Basic text
      helper.drawText('Simple Text', 30, 30, {
        color: COLORS.UI.TEXT,
        fontSize: 14
      });
      
      // Text with background
      helper.drawText('Label with Background', 140, 60, {
        background: COLORS.UI.HIGHLIGHT,
        color: COLORS.UI.BACKGROUND,
        padding: 6,
        align: 'center'
      });
      
      // Different alignments
      helper.drawLabel('Center Label', 140, 100, {
        background: COLORS.STATUS.ONLINE
      });
      
      helper.drawLabel('Left Label', 70, 130, {
        background: COLORS.STATUS.WARNING,
        align: 'left'
      });
      
      helper.drawLabel('Right Label', 210, 130, {
        background: COLORS.STATUS.ERROR,
        align: 'right'
      });
      
      // Formatted values
      const bandwidth = NetworkFormatter.bandwidth(1e9);
      helper.drawLabel(bandwidth, 140, 170, {
        background: COLORS.PACKET.TCP,
        color: COLORS.UI.BACKGROUND
      });
    }
    
    // Test 6: Progress Bars
    function testProgress() {
      const canvas = document.getElementById('progress-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      let progress = 0;
      
      function animate() {
        helper.clear(COLORS.UI.BACKGROUND);
        
        progress = (progress + 0.005) % 1.2;
        
        // Different progress bars
        helper.drawProgressBar(30, 30, 220, 20, Math.min(1, progress), {
          showText: true,
          progressColor: COLORS.STATUS.ONLINE
        });
        
        helper.drawProgressBar(30, 70, 220, 15, Math.min(1, progress * 0.7), {
          progressColor: COLORS.STATUS.WARNING
        });
        
        helper.drawProgressBar(30, 100, 220, 25, Math.min(1, progress * 0.5), {
          showText: true,
          progressColor: COLORS.STATUS.ERROR,
          text: `${NetworkFormatter.percentage(Math.min(1, progress * 0.5))}`
        });
        
        // Utilization bars
        helper.drawText('Network Utilization:', 30, 150, { fontSize: 12 });
        helper.drawProgressBar(30, 160, 220, 12, 0.3, {
          progressColor: COLORS.STATUS.ONLINE
        });
        
        requestAnimationFrame(animate);
      }
      animate();
    }
    
    // Test 7: Gradients
    function testGradients() {
      const canvas = document.getElementById('gradients-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      helper.clear(COLORS.UI.BACKGROUND);
      
      // Linear gradient
      const linearGrad = helper.createLinearGradient(30, 30, 250, 30, [
        { offset: 0, color: COLORS.GRADIENTS.SPEED[0] },
        { offset: 0.5, color: COLORS.GRADIENTS.SPEED[1] },
        { offset: 1, color: COLORS.GRADIENTS.SPEED[2] }
      ]);
      
      ctx.fillStyle = linearGrad;
      ctx.fillRect(30, 30, 220, 40);
      
      // Radial gradient for node
      const radialGrad = helper.createRadialGradient(140, 120, 0, 50, [
        { offset: 0, color: COLORS.PACKET.TCP },
        { offset: 0.7, color: COLORS.PACKET.UDP },
        { offset: 1, color: COLORS.UI.BACKGROUND }
      ]);
      
      ctx.fillStyle = radialGrad;
      ctx.beginPath();
      ctx.arc(140, 120, 50, 0, Math.PI * 2);
      ctx.fill();
    }
    
    // Test 8: Grid
    function testGrid() {
      const canvas = document.getElementById('grid-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      helper.clear(COLORS.UI.BACKGROUND);
      helper.drawGrid(280, 200, {
        cellSize: 20,
        majorEvery: 3
      });
      
      // Draw something on top
      helper.drawNode(140, 100, 'router', { icon: 'üåê' });
    }
    
    // Main Interactive Demo
    let showGrid = false;
    let darkTheme = false;
    let animationId = null;
    let packets = [];
    
    function setupMainDemo() {
      const canvas = document.getElementById('main-canvas');
      const ctx = canvas.getContext('2d');
      const helper = new CanvasHelper(ctx);
      
      // Setup high DPI
      helper.setupHighDPI(canvas, 800, 400);
      
      // Network topology
      const nodes = [
        { x: 100, y: 200, type: 'client', label: 'Client', icon: 'üíª' },
        { x: 300, y: 100, type: 'router', label: 'Router 1', icon: 'üîÑ' },
        { x: 300, y: 300, type: 'router', label: 'Router 2', icon: 'üîÑ' },
        { x: 500, y: 200, type: 'switch', label: 'Switch', icon: 'üîÄ' },
        { x: 700, y: 200, type: 'server', label: 'Server', icon: 'üñ•Ô∏è' }
      ];
      
      const links = [
        { from: 0, to: 1, type: 'wireless' },
        { from: 0, to: 2, type: 'ethernet' },
        { from: 1, to: 3, type: 'fiber' },
        { from: 2, to: 3, type: 'fiber' },
        { from: 3, to: 4, type: 'ethernet' }
      ];
      
      // Mouse interaction
      let mouseX = 0, mouseY = 0;
      let hoveredNode = null;
      
      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;
        
        // Check hover
        hoveredNode = null;
        for (const node of nodes) {
          const dist = Math.sqrt(Math.pow(mouseX - node.x, 2) + Math.pow(mouseY - node.y, 2));
          if (dist < 30) {
            hoveredNode = node;
            break;
          }
        }
      });
      
      function render() {
        // Clear and setup background
        helper.clear(darkTheme ? COLORS.UI.DARK_BACKGROUND : COLORS.UI.BACKGROUND);
        
        // Draw grid if enabled
        if (showGrid) {
          helper.setAlpha(0.3);
          helper.drawGrid(800, 400);
          helper.setAlpha(1);
        }
        
        // Draw links
        for (const link of links) {
          const from = nodes[link.from];
          const to = nodes[link.to];
          helper.drawLink(from.x, from.y, to.x, to.y, {
            type: link.type,
            arrow: true
          });
        }
        
        // Draw nodes
        for (const node of nodes) {
          helper.drawNode(node.x, node.y, node.type, {
            icon: node.icon,
            label: node.label,
            selected: node === hoveredNode
          });
        }
        
        // Update and draw packets
        packets = packets.filter(p => {
          p.progress += 0.01;
          if (p.progress > 1) return false;
          
          const from = nodes[p.from];
          const to = nodes[p.to];
          const x = from.x + (to.x - from.x) * p.progress;
          const y = from.y + (to.y - from.y) * p.progress;
          
          helper.drawPacket(x, y, {
            type: p.type,
            label: p.id
          });
          
          return true;
        });
        
        // Draw tooltip if hovering
        if (hoveredNode) {
          const latency = Math.random() * 50;
          const text = `${hoveredNode.label}: ${NetworkFormatter.time(latency)}`;
          helper.drawTooltip(text, hoveredNode.x, hoveredNode.y - 40, {
            background: darkTheme ? COLORS.UI.BACKGROUND : COLORS.UI.DARK_BACKGROUND,
            textColor: darkTheme ? COLORS.UI.TEXT : COLORS.UI.BACKGROUND
          });
        }
        
        // Draw title
        helper.drawText('Network Topology Visualization', 400, 30, {
          align: 'center',
          fontSize: 18,
          fontWeight: 'bold',
          color: darkTheme ? COLORS.UI.BACKGROUND : COLORS.UI.TEXT
        });
        
        requestAnimationFrame(render);
      }
      
      render();
    }
    
    // Button handlers
    window.animatePackets = function() {
      // Add random packets
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          const types = ['TCP', 'UDP', 'ICMP', 'DEFAULT'];
          packets.push({
            id: packets.length + 1,
            from: 0,
            to: 4,
            type: types[Math.floor(Math.random() * types.length)],
            progress: 0
          });
        }, i * 200);
      }
      
      document.getElementById('main-status').className = 'status success';
      document.getElementById('main-status').textContent = 'Packets animated!';
    };
    
    window.toggleGrid = function() {
      showGrid = !showGrid;
      document.getElementById('main-status').textContent = `Grid ${showGrid ? 'enabled' : 'disabled'}`;
    };
    
    window.changeTheme = function() {
      darkTheme = !darkTheme;
      document.getElementById('main-status').textContent = `Theme changed to ${darkTheme ? 'dark' : 'light'}`;
    };
    
    window.resetDemo = function() {
      packets = [];
      showGrid = false;
      darkTheme = false;
      document.getElementById('main-status').textContent = 'Demo reset';
    };
    
    // Initialize all tests
    testShapes();
    testNodes();
    testLinks();
    testPackets();
    testText();
    testProgress();
    testGradients();
    testGrid();
    setupMainDemo();
    
    console.log('‚úÖ CanvasHelper tests initialized successfully');
  </script>
</body>
</html>